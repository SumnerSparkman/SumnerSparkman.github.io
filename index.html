<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QR Code Generator</title>
  <meta name="description" content="Enter any URL or text to instantly generate a QR code in your browser. No server required." />
  <style>
    :root { --gap: 14px; }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background: #f9fafb; color: #111827; }
    .wrap { min-height: 100%; display: grid; place-items: center; padding: 24px; }
    .card { width: min(92vw, 760px); background: white; border: 1px solid #e5e7eb; border-radius: 18px; box-shadow: 0 10px 30px rgba(0,0,0,0.06); padding: 22px; }
    h1 { margin: 0 0 8px; font-size: clamp(1.25rem, 0.8rem + 2vw, 1.75rem); }
    p.sub { margin: 0 0 20px; color: #4b5563; }
    form { display: grid; gap: var(--gap); margin-bottom: 14px; }
    .row { display: grid; gap: var(--gap); grid-template-columns: 1fr; }
    @media (min-width: 720px){ .row { grid-template-columns: 1fr auto; align-items: end; } }
    label { font-weight: 600; font-size: 0.95rem; }
    input[type="url"], input[type="text"], select { width: 100%; padding: 12px 14px; border: 1px solid #d1d5db; border-radius: 12px; font-size: 1rem; }
    .controls { display: grid; gap: var(--gap); grid-template-columns: repeat(3, minmax(0,1fr)); }
    .controls > div { display: grid; gap: 8px; }
    button { cursor: pointer; padding: 12px 16px; border-radius: 12px; border: 1px solid #111827; background: #111827; color: white; font-weight: 600; }
    button.secondary { background: white; color: #111827; border-color: #d1d5db; }
    .qr-wrap { display: grid; place-items: center; padding: 18px; border: 1px dashed #e5e7eb; border-radius: 16px; margin-top: 10px; }
    #qrcode { width: 100%; display: grid; place-items: center; }
    .actions { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 12px; }
    .hint { font-size: 12px; color: #6b7280; margin-top: 8px; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" integrity="sha512-BLx0SB9EcaxqfO2eQxEUY1vK4t7T/1DgWBAE6wHh4mOo2uUFM2cR4Jt7d9aS4a4g2k4m9b3XgU9cwZkB6YF9Zg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
  <main class="wrap">
    <section class="card">
      <h1>QR Code Generator</h1>
      <p class="sub">Enter a URL (or any text) and get a downloadable QR code instantly. All in your browser.</p>

      <form id="qrForm">
        <div>
          <label for="input">URL or text</label>
          <div class="row">
            <input id="input" name="input" type="url" inputmode="url" placeholder="https://example.com" required/>
            <button id="makeBtn" type="submit">Generate</button>
          </div>
        </div>

        <div class="controls">
          <div>
            <label for="size">Size (px)</label>
            <input id="size" name="size" type="number" min="128" max="2048" step="32" value="512" />
          </div>
          <div>
            <label for="ec">Error correction</label>
            <select id="ec" name="ec">
              <option value="L">L (7%)</option>
              <option value="M" selected>M (15%)</option>
              <option value="Q">Q (25%)</option>
              <option value="H">H (30%)</option>
            </select>
          </div>
          <div>
            <label for="margin">Quiet zone (modules)</label>
            <input id="margin" name="margin" type="number" min="0" max="8" step="1" value="4" />
          </div>
        </div>
      </form>

      <div class="qr-wrap">
        <div id="qrcode" aria-label="QR code output" role="img"></div>
      </div>

      <div class="actions">
        <button id="download" class="secondary" type="button">Download PNG</button>
        <button id="copyurl" class="secondary" type="button">Copy input text</button>
        <button id="share" class="secondary" type="button">Share</button>
        <button id="permalink" class="secondary" type="button">Copy page permalink</button>
      </div>
      <div class="hint">Tip: You can bookmark/share a pre-filled page like <code>?u=https://example.com&s=512&e=M&m=4</code>.</div>
    </section>
  </main>

  <script>
    // Helpers
    const $ = (sel) => document.querySelector(sel);
    const params = new URLSearchParams(location.search);

    const inputEl = $('#input');
    const sizeEl = $('#size');
    const ecEl = $('#ec');
    const marginEl = $('#margin');
    const dlBtn = $('#download');
    const copyBtn = $('#copyurl');
    const shareBtn = $('#share');
    const linkBtn = $('#permalink');
    const form = $('#qrForm');

    // Map EC letter to QRCodeJS constant
    const EC = { L: QRCode.CorrectLevel.L, M: QRCode.CorrectLevel.M, Q: QRCode.CorrectLevel.Q, H: QRCode.CorrectLevel.H };

    // Prefill from query string
    if (params.has('u')) inputEl.value = params.get('u');
    if (params.has('s')) sizeEl.value = clamp(parseInt(params.get('s'), 10), 128, 2048);
    if (params.has('e') && ['L','M','Q','H'].includes(params.get('e'))) ecEl.value = params.get('e');
    if (params.has('m')) marginEl.value = clamp(parseInt(params.get('m'), 10), 0, 8);

    let qrInstance = null;

    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    function clearQR(){
      const holder = document.getElementById('qrcode');
      holder.innerHTML = '';
    }

    function makeQR(){
      const text = inputEl.value.trim();
      if (!text) { clearQR(); return; }
      const size = clamp(parseInt(sizeEl.value, 10) || 512, 128, 2048);
      const level = EC[ecEl.value] || QRCode.CorrectLevel.M;
      const margin = clamp(parseInt(marginEl.value, 10) || 4, 0, 8);
      clearQR();
      qrInstance = new QRCode(document.getElementById('qrcode'), {
        text,
        width: size,
        height: size,
        colorDark: '#000000',
        colorLight: '#ffffff',
        correctLevel: level
      });
      // qrcodejs doesn't expose margin; we simulate by padding the container
      document.getElementById('qrcode').style.padding = Math.max(0, margin * 2) + 'px';
    }

    // Generate on submit and on change
    form.addEventListener('submit', (e) => { e.preventDefault(); makeQR(); });
    [inputEl, sizeEl, ecEl, marginEl].forEach(el => el.addEventListener('change', makeQR));

    // Initial generation if prefilled
    if (inputEl.value) makeQR();

    // Download PNG
    dlBtn.addEventListener('click', () => {
      const png = document.querySelector('#qrcode canvas');
      if (!png) return alert('Generate a QR first.');
      const link = document.createElement('a');
      link.download = 'qr.png';
      link.href = png.toDataURL('image/png');
      link.click();
    });

    // Copy input text
    copyBtn.addEventListener('click', async () => {
      const v = inputEl.value.trim();
      if (!v) return alert('Nothing to copy.');
      await navigator.clipboard.writeText(v);
      copyBtn.textContent = 'Copied!';
      setTimeout(() => copyBtn.textContent = 'Copy input text', 1200);
    });

    // Web Share API
    shareBtn.addEventListener('click', async () => {
      try {
        const url = new URL(location.href);
        url.search = makeQuery();
        if (navigator.share) {
          await navigator.share({ title: 'QR Code', url: url.toString() });
        } else {
          await navigator.clipboard.writeText(url.toString());
          alert('Link copied to clipboard.');
        }
      } catch (e) { alert('Unable to share.'); }
    });

    // Permalink builder
    function makeQuery(){
      const q = new URLSearchParams();
      if (inputEl.value.trim()) q.set('u', inputEl.value.trim());
      q.set('s', clamp(parseInt(sizeEl.value, 10) || 512, 128, 2048));
      q.set('e', ecEl.value);
      q.set('m', clamp(parseInt(marginEl.value, 10) || 4, 0, 8));
      return q.toString();
    }

    linkBtn.addEventListener('click', async () => {
      const url = new URL(location.href);
      url.search = makeQuery();
      await navigator.clipboard.writeText(url.toString());
      linkBtn.textContent = 'Permalink copied!';
      setTimeout(() => linkBtn.textContent = 'Copy page permalink', 1200);
    });
  </script>
</body>
</html>
