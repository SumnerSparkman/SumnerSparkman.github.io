<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QR Code Generator</title>
  <meta name="description" content="Enter any URL or text to instantly generate a QR code in your browser. No server required." />
  <style>
    html, body { height: 100%; margin: 0; font-family: system-ui, sans-serif; background: #f9fafb; color: #111827; }
    .wrap { min-height: 100%; display: grid; place-items: center; padding: 24px; }
    .card { width: min(92vw, 600px); background: white; border: 1px solid #e5e7eb; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.06); padding: 22px; }
    h1 { margin: 0 0 8px; font-size: clamp(1.25rem, 0.8rem + 2vw, 1.75rem); }
    p.sub { margin: 0 0 20px; color: #4b5563; }
    input[type="text"] { width: 100%; padding: 12px 14px; border: 1px solid #d1d5db; border-radius: 12px; font-size: 1rem; }
    .qr-wrap { display: grid; place-items: center; padding: 18px; border: 1px dashed #e5e7eb; border-radius: 16px; margin-top: 20px; }
    #qrcode { width: 100%; display: grid; place-items: center; }
    .actions { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 12px; }
    button { cursor: pointer; padding: 12px 16px; border-radius: 12px; border: 1px solid #111827; background: #111827; color: white; font-weight: 600; }
    button.secondary { background: white; color: #111827; border-color: #d1d5db; }
  </style>
  <script src="./qrcode.min.js"></script>
</head>
<body>
  <main class="wrap">
    <section class="card">
      <h1>QR Code Generator</h1>
      <p class="sub">Enter a URL or any text and get a downloadable QR code instantly.</p>

      <input id="input" name="input" type="text" placeholder="example.com or https://example.com" />

      <div class="qr-wrap">
        <div id="qrcode" aria-label="QR code output" role="img"></div>
      </div>

      <div class="actions">
        <button id="download" class="secondary" type="button">Download PNG</button>
        <button id="copyurl" class="secondary" type="button">Copy input text</button>
        <button id="share" class="secondary" type="button">Share</button>
        <button id="permalink" class="secondary" type="button">Copy page permalink</button>
      </div>
    </section>
  </main>

  <script>
    const $ = (sel) => document.querySelector(sel);
    const inputEl = $('#input');
    const dlBtn = $('#download');
    const copyBtn = $('#copyurl');
    const shareBtn = $('#share');
    const linkBtn = $('#permalink');
    let lastText = '';

    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }
    function clearQR(){ $('#qrcode').innerHTML = ''; }
    function normalizeInput(raw){
      let v = raw.trim();
      if (!v) return '';
      const looksLikeUrl = /^[^\s]+\.[^\s]+/.test(v) || /^localhost(:\d+)?(\/|$)/i.test(v);
      const hasScheme = /^[a-zA-Z][a-zA-Z0-9+.-]*:\/\//.test(v);
      if (looksLikeUrl && !hasScheme){
        const parts = v.split('/');
        const host = parts[0];
        const hasSub = host.split('.').length > 2 || host.toLowerCase().startsWith('www.');
        if (!hasSub) parts[0] = 'www.' + host;
        v = 'https://' + parts.join('/');
      }
      return v;
    }
    function makeQR(){
      if (typeof QRCode === 'undefined') {
        alert('QR library failed to load.');
        return;
      }
      const text = normalizeInput(inputEl.value);
      if (!text) { clearQR(); lastText = ''; return; }
      if (text === lastText) return;
      lastText = text;
      clearQR();
      new QRCode($('#qrcode'), {
        text,
        width: 512,
        height: 512,
        colorDark: '#000000',
        colorLight: '#ffffff',
        correctLevel: QRCode.CorrectLevel.M
      });
      $('#qrcode').style.padding = '8px';
    }
    inputEl.addEventListener('input', () => { lastText = ''; makeQR(); });

    dlBtn.addEventListener('click', () => {
      const canv = document.querySelector('#qrcode canvas');
      const img = document.querySelector('#qrcode img');
      if (!canv && !img) return alert('Generate a QR first.');
      const dataUrl = canv ? canv.toDataURL('image/png') : (img && img.src ? img.src : '');
      if (!dataUrl.startsWith('data:image')) return alert('Unable to get image data.');
      const link = document.createElement('a');
      link.download = 'qr.png';
      link.href = dataUrl;
      link.click();
    });
    copyBtn.addEventListener('click', async () => {
      const v = normalizeInput(inputEl.value);
      if (!v) return alert('Nothing to copy.');
      await navigator.clipboard.writeText(v);
      copyBtn.textContent = 'Copied!';
      setTimeout(() => copyBtn.textContent = 'Copy input text', 1200);
    });
    shareBtn.addEventListener('click', async () => {
      try {
        const url = new URL(location.href);
        url.search = '?u=' + encodeURIComponent(normalizeInput(inputEl.value));
        if (navigator.share) {
          await navigator.share({ title: 'QR Code', url: url.toString() });
        } else {
          await navigator.clipboard.writeText(url.toString());
          alert('Link copied to clipboard.');
        }
      } catch { alert('Unable to share.'); }
    });
    linkBtn.addEventListener('click', async () => {
      const url = new URL(location.href);
      url.search = '?u=' + encodeURIComponent(normalizeInput(inputEl.value));
      await navigator.clipboard.writeText(url.toString());
      linkBtn.textContent = 'Permalink copied!';
      setTimeout(() => linkBtn.textContent = 'Copy page permalink', 1200);
    });
  </script>
</body>
</html>
